import{r as N,j as I,av as A,s as S,X as C,y as D,aw as P}from"./chunk-B5bTUUgP.js";import{c as E,B as H,C as $,a as F,b as R,d as K,I as T,A as W}from"./index-DO8XdK_C.js";import{aD as B}from"./chunk-C0OmHN55.js";import"./chunk-BhYyqFdl.js";import"./chunk-BlK9U3hL.js";import"./chunk-DxiFtySX.js";import"./chunk-C3wd7mYu.js";const L=N.forwardRef(({className:N,children:A,...S},C)=>I.jsx("div",{ref:C,className:E("relative overflow-auto",N),...S,children:A}));L.displayName="ScrollArea";const FloatingChatBot=({analysisResults:E})=>{const[O,Q]=N.useState(!1),[U,G]=N.useState([]),[J,M]=N.useState(""),[V,X]=N.useState(!1),Y=N.useRef(null),Z=new W;N.useEffect(()=>{var N;if(O&&0===U.length){const I={id:"1",role:"assistant",content:`Hello! I'm your AI assistant for code analysis. I can help you understand the analysis results of your codebase. \n\nI found ${(null==(N=null==E?void 0:E.issues)?void 0:N.length)||0} issues across ${(null==E?void 0:E.totalFiles)||0} files. Feel free to ask me questions like:\n- "What are the most critical security issues?"\n- "Show me all high severity bugs"\n- "How can I improve my code quality?"\n- "What should I fix first?"\n\nHow can I help you today?`,timestamp:new Date};G([I])}},[O,E,U.length]);const _=N.useCallback(()=>{Y.current&&(Y.current.scrollTop=Y.current.scrollHeight)},[]);N.useEffect(()=>{_()},[U.length,_]);const handleSendMessage=async()=>{if(!J.trim()||V)return;const N={id:Date.now().toString(),role:"user",content:J,timestamp:new Date};G(I=>[...I,N]);const I=J;M(""),X(!0);try{if(!E||!E.issues)throw new Error("No analysis results available. Please run an analysis first.");const N=await Z.answerQuestion(I,E),A={id:(Date.now()+1).toString(),role:"assistant",content:N,timestamp:new Date};G(N=>[...N,A])}catch(A){let N="Sorry, I encountered an error while processing your question.";A instanceof Error&&(N=A.message.includes("No AI API keys configured")?"Please configure your AI API keys in the AI Configuration tab to use this feature.":A.message.includes("All AI providers failed")?"Unable to connect to AI services. Please check your API keys are valid and have sufficient credits.":A.message.includes("No analysis results")?"No analysis results found. Please upload and analyze a code file first.":`AI Service Error: ${A.message}`),B.error(N);const I={id:(Date.now()+1).toString(),role:"assistant",content:N,timestamp:new Date};G(N=>[...N,I])}finally{X(!1)}};return E?I.jsxs(I.Fragment,{children:[!O&&I.jsx(H,{onClick:()=>Q(!0),className:"fixed bottom-4 right-4 sm:bottom-6 sm:right-6 h-12 w-12 sm:h-14 sm:w-14 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-lg hover:shadow-xl transition-all duration-300 z-50 focus-ring animate-float",size:"sm","aria-label":"Open AI chat assistant",children:I.jsx(A,{className:"h-5 w-5 sm:h-6 sm:w-6"})}),O&&I.jsxs($,{className:"fixed bottom-4 right-4 sm:bottom-6 sm:right-6 w-[calc(100vw-2rem)] max-w-sm sm:w-96 h-[70vh] max-h-[500px] shadow-2xl z-50 bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm border-0 animate-slide-up",children:[I.jsx(F,{className:"pb-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-t-lg",children:I.jsxs("div",{className:"flex items-center justify-between",children:[I.jsxs(R,{className:"flex items-center gap-2 text-base sm:text-lg",children:[I.jsx(S,{className:"h-4 w-4 sm:h-5 sm:w-5"}),I.jsx("span",{className:"hidden sm:inline",children:"AI Analysis Assistant"}),I.jsx("span",{className:"sm:hidden",children:"AI Assistant"})]}),I.jsx(H,{variant:"ghost",size:"sm",onClick:()=>Q(!1),className:"text-white hover:bg-white/20 h-8 w-8 p-0 focus-ring","aria-label":"Close chat",children:I.jsx(C,{className:"h-4 w-4"})})]})}),I.jsxs(K,{className:"p-0 flex flex-col h-[calc(70vh-80px)] max-h-[420px]",children:[I.jsx(L,{className:"flex-1 p-3 sm:p-4",ref:Y,children:I.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[U.map(N=>I.jsx("div",{className:`flex ${"user"===N.role?"justify-end":"justify-start"} animate-fade-in`,children:I.jsxs("div",{className:"max-w-[85%] sm:max-w-[80%] rounded-lg p-2 sm:p-3 "+("user"===N.role?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white"),children:[I.jsx("p",{className:"text-xs sm:text-sm whitespace-pre-wrap leading-relaxed",children:N.content}),I.jsx("span",{className:"text-xs opacity-70 mt-1 block",children:N.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},N.id)),V&&I.jsx("div",{className:"flex justify-start animate-fade-in",children:I.jsxs("div",{className:"bg-slate-100 dark:bg-slate-800 rounded-lg p-2 sm:p-3 flex items-center gap-2",children:[I.jsx(D,{className:"h-3 w-3 sm:h-4 sm:w-4 animate-spin"}),I.jsx("span",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"AI is thinking..."})]})})]})}),I.jsx("div",{className:"p-3 sm:p-4 border-t border-slate-200 dark:border-slate-700",children:I.jsxs("div",{className:"flex gap-2",children:[I.jsx(T,{value:J,onChange:e=>M(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),handleSendMessage())},placeholder:"Ask about your code analysis...",disabled:V,className:"flex-1 text-sm focus-ring","aria-label":"Chat message input"}),I.jsx(H,{onClick:handleSendMessage,disabled:!J.trim()||V,size:"sm",className:"bg-blue-600 hover:bg-blue-700 focus-ring flex-shrink-0","aria-label":"Send message",children:I.jsx(P,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]})})]})]})]}):null};export{FloatingChatBot as default};
